<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Soru Çarkı</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f8f8f8;
    text-align: center;
    padding: 40px;
    position: relative;
    min-height: 700px;
  }
  h1 {
    margin-top: 0;
    margin-bottom: 120px;
    position: relative;
    z-index: 20;
  }
  #wheel-container {
    width: 500px;
    height: 500px;
    margin: 0 auto;
    position: relative;
    z-index: 5;
  }
  canvas {
    border: 5px solid #333;
    border-radius: 50%;
    background: white;
  }
  #pointer {
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-top: 40px solid red;
    position: absolute;
    top: 120px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 15;
  }
  button {
    margin-top: 35px;
    padding: 12px 25px;
    font-size: 18px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: #218838;
  }
  #result {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
    color: #333;
    min-height: 60px;
    white-space: pre-line;
  }
  #videoPopup {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 999;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  #videoPopup.show {
    display: flex;
    opacity: 1;
  }
  #player {
    width: 800px;
    height: 450px;
    border: none;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  }
</style>
</head>
<body>

<h1>🎯 Soru Çarkı</h1>

<div id="wheel-container">
  <canvas id="wheel" width="500" height="500"></canvas>
</div>

<div id="pointer"></div>

<button onclick="spinWheel()">Çevir!</button>

<div id="result"></div>

<div id="videoPopup">
  <div id="player"></div>
</div>

<audio id="spinSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_4e4faff739.mp3" preload="auto"></audio>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
  let player;
  const totalSegments = 50;
  const numbers = Array.from({ length: totalSegments }, (_, i) => i + 1);

  const questions = [
    "Karabük'ün tarihçesi nedir?",
    "Safranbolu hakkında ne düşünüyorsunuz?",
    "Karabük'te en çok ziyaret edilen müze hangisidir?",
    "Karabük'ün en meşhur yemeği nedir?",
    "Şehirde düzenlenen kültürel etkinlikler nelerdir?",
    "Karabük'teki doğal güzellikleri sayar mısınız?",
    "Karabük Demir Çelik Fabrikası'nın önemi nedir?",
    "Şehirde ulaşım imkanları nasıl?",
    "Karabük'te eğitim kalitesi hakkında ne düşünüyorsunuz?",
    "Karabük'te gençler için hangi sosyal imkanlar var?",
    "Şehirde sağlık hizmetleri yeterli mi?",
    "Karabük'teki geleneksel el sanatları nelerdir?",
    "Karabük'te turizm potansiyeli nedir?",
    "Şehirde en çok hangi spor dalları tercih ediliyor?",
    "Karabük'te iş imkanları nasıl?",
    "Karabük'teki yerel festivaller hangileridir?",
    "Şehirde çevre koruma çalışmaları yapılıyor mu?",
    "Karabük'te kadınların sosyal yaşamdaki rolü nedir?",
    "Şehirde en popüler konut tipi hangisidir?",
    "Karabük'te en eski tarihi yapı hangisidir?",
    "Karabük'te yaşam maliyeti nasıldır?",
    "Şehirde genç girişimcilik destekleniyor mu?",
    "Karabük'te sanat galerileri veya müzeler var mı?",
    "Şehirde ulaşım altyapısı yeterli mi?",
    "Karabük'te yerel halk en çok neyle gurur duyuyor?",
    "Karabük'te eğitim ve öğretim kalitesi nasıl?",
    "Karabük'te en çok hangi meslek grupları çalışıyor?",
    "Şehirde sosyal sorumluluk projeleri yürütülüyor mu?",
    "Karabük'te çocuklar için oyun alanları yeterli mi?",
    "Karabük'teki tarihi yapılar nasıl korunuyor?",
    "Şehirde çevre sorunları nelerdir?",
    "Karabük'te konut fiyatları nasıl?",
    "Karabük'te kültürel çeşitlilik var mı?",
    "Şehirde en çok hangi tarım ürünleri yetişiyor?",
    "Karabük'te spor faaliyetleri nasıl organize ediliyor?",
    "Karabük'teki nüfus yapısı nasıldır?",
    "Şehirde en çok tercih edilen ulaşım aracı hangisidir?",
    "Karabük'te sanat ve kültür faaliyetleri nasıl destekleniyor?",
    "Şehirde sağlık hizmetlerinin kalitesi nedir?",
    "Karabük'te sosyal yaşam nasıl?",
    "Karabük'teki iklim koşulları nasıldır?",
    "Şehirde turistler için hangi aktiviteler var?",
    "Karabük'te işsizlik oranı nedir?",
    "Karabük'te ulaşımda yaşanan sorunlar nelerdir?",
    "Karabük'teki yerel lezzetler nelerdir?",
    "Şehirde eğitim kurumları yeterli mi?",
    "Karabük'te en çok ziyaret edilen doğal park neresi?",
    "Şehirde kadınların sosyal yaşamdaki yeri nedir?",
    "Karabük'te kültürel miras nasıl yaşatılıyor?"
  ];

  const wheelCanvas = document.getElementById("wheel");
  const ctx = wheelCanvas.getContext("2d");
  const spinSound = document.getElementById("spinSound");
  const resultDiv = document.getElementById("result");
  const videoPopup = document.getElementById("videoPopup");
  const playerDiv = document.getElementById("player");

  const arcSize = (2 * Math.PI) / totalSegments;
  let startAngle = 0;
  let spinning = false;
  let rotation = 0;
  let currentIndex = null;

  function drawWheel() {
    for (let i = 0; i < totalSegments; i++) {
      const angle = startAngle + i * arcSize;
      ctx.beginPath();
      ctx.moveTo(250, 250);
      ctx.arc(250, 250, 250, angle, angle + arcSize, false);
      ctx.fillStyle = i % 2 === 0 ? "#add8e6" : "#ffffff";
      ctx.fill();
      ctx.save();
      ctx.translate(250, 250);
      ctx.rotate(angle + arcSize / 2);
      ctx.textAlign = "right";
      ctx.fillStyle = "#000";
      ctx.font = "14px Arial";
      ctx.fillText(numbers[i], 230, 5);
      ctx.restore();
    }
  }

  function spinWheel() {
    if (spinning) return;
    spinning = true;
    spinSound.currentTime = 0;
    spinSound.play();

    const spins = Math.floor(Math.random() * 3) + 5; // 5-7 tur
    const finalAngle = Math.random() * 360;
    const totalRotation = spins * 360 + finalAngle;
    const duration = 4000;
    const start = performance.now();

    function animate(time) {
      const elapsed = time - start;
      const progress = Math.min(elapsed / duration, 1);
      const easing = 1 - Math.pow(1 - progress, 3); // yumuşak hızlanma
      rotation = totalRotation * easing;
      startAngle = (rotation * Math.PI) / 180;
      ctx.clearRect(0, 0, 500, 500);
      drawWheel();
      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        spinning = false;
        // Son pozisyon hesapla:
        const degrees = rotation % 360;
        // 0 derece 12 yönü, biz çarkı saat yönünün tersine döndürdüğümüz için:
        let index = Math.floor((360 - degrees) / (360 / totalSegments)) % totalSegments;
        if (index < 0) index += totalSegments;
        currentIndex = index;
        showVideo(index);
      }
    }
    requestAnimationFrame(animate);
  }

  function showVideo(index) {
    videoPopup.classList.add("show");
    if (!player) {
      player = new YT.Player('player', {
        height: '450',
        width: '800',
        videoId: 'mhjhUi5bQT8',  // video ID
        playerVars: {
          autoplay: 1,
          controls: 1,
          start: 0,
          end: 30,
          modestbranding: 1,
          rel: 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    } else {
      player.seekTo(0);
      player.playVideo();
    }
    resultDiv.textContent = "";
  }

  function onPlayerReady(event) {
    event.target.playVideo();
  }

  function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.ENDED) {
      closeVideoAndShowQuestion(currentIndex);
    }
    if (event.data === YT.PlayerState.PLAYING) {
      checkPosition();
    }
  }

  function checkPosition() {
    if (!player) return;
    const currentTime = player.getCurrentTime();
    const duration = player.getDuration();
    if (duration - currentTime <= 0.5) {
      closeVideoAndShowQuestion(currentIndex);
    } else {
      setTimeout(checkPosition, 500);
    }
  }

  function closeVideoAndShowQuestion(index) {
    videoPopup.classList.remove("show");
    if (player) player.pauseVideo();
    if (index !== null && questions[index]) {
      resultDiv.textContent = `Numara: ${numbers[index]}\nSoru: ${questions[index]}`;
    } else {
      resultDiv.textContent = "Soru bulunamadı.";
    }
    currentIndex = null;
  }

  videoPopup.addEventListener("click", () => {
    if (!spinning && currentIndex !== null) {
      closeVideoAndShowQuestion(currentIndex);
    }
  });

  drawWheel();
</script>

</body>
</html>
